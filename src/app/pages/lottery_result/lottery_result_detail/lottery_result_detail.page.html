<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
      <ion-back-button defaultHref="/lottery_result"></ion-back-button>
    </ion-buttons>
    <ion-title>
      {{ mode === 'view' ? 'Ver Resultado de Loter√≠a' : mode === 'edit' ? 'Editar Resultado de Loter√≠a' : 'Agregar Resultado' }}
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- üîπ Mostrar loading mientras se cargan los datos -->
  <ng-container *ngIf="isLoading; else content">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Cargando informaci√≥n...</p>
  </ng-container>

  <!-- üîπ Renderizar el contenido solo si isLoading es false -->
  <ng-template #content>
    <form *ngIf="mode === 'edit'" [formGroup]="lotteryResultForm">
      <ion-item>
        <ion-label position="stacked">Loter√≠a</ion-label>
        <ion-select formControlName="lottery_id">
          <ion-select-option *ngFor="let lottery of lotteries" [value]="lottery.id">
            {{ lottery.name }}
          </ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Fecha</ion-label>
        <ion-datetime formControlName="result_date"
                      presentation="date"
                      display-format="YYYY-MM-DD"
                      picker-format="YYYY-MM-DD">
        </ion-datetime>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Hora</ion-label>
        <ion-select formControlName="lottery_schedule_id">
          <ion-select-option *ngFor="let schedule of lotterySchedules" [value]="schedule.id">
            {{ schedule.time | formatTime }}
          </ion-select-option>
        </ion-select>
      </ion-item>

      <ion-item>
        <ion-label position="stacked">Resultado</ion-label>
        <ion-select formControlName="lottery_option_id">
          <ion-select-option *ngFor="let option of lotteryOptions" [value]="option.id">
            {{ option.name }}
          </ion-select-option>
        </ion-select>
      </ion-item>
    </form>

    <div *ngIf="mode === 'view' && lotteryResult">
      <p><strong>Loter√≠a:</strong> {{ getLotteryName(lotteryResult.lottery_id) }}</p>
      <p><strong>Fecha:</strong> {{ lotteryResult.result_date | date:'dd-MM-yyyy' }}</p>
      <p><strong>Hora:</strong> {{ getScheduleTime(lotteryResult.lottery_schedule_id) | formatTime }}</p>
      <p><strong>Resultado:</strong> {{ getOptionName(lotteryResult.lottery_option_id) }}</p>
    </div>
  </ng-template>
</ion-content>

<ion-footer *ngIf="mode === 'edit'">
  <ion-toolbar>
    <ion-button expand="block" (click)="saveLotteryResult()" [disabled]="lotteryResultForm.invalid">Guardar</ion-button>
  </ion-toolbar>
</ion-footer>
